<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>RifariRD 2026 â€” Â¡Gana RD$50,000!</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --blue:    #1A4FBD;
  --blue2:   #1240A0;
  --blue3:   #0D2D78;
  --sky:     #3B82F6;
  --yellow:  #FFD700;
  --yellow2: #FFC107;
  --orange:  #FF8C00;
  --bg:      #0B1A3E;
  --bg2:     #0D2050;
  --card:    #122468;
  --card2:   #1A3080;
  --border:  #2A4A9A;
  --border2: #3A5AB0;
  --text:    #EEF4FF;
  --muted:   #7B9FD4;
  --green:   #22C55E;
  --red:     #EF4444;
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
}

/* â”€â”€ FONDOS â”€â”€ */
.bg-wrap{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;}
.bg-radial{
  position:absolute;inset:0;
  background:
    radial-gradient(ellipse 700px 500px at 0% 0%,rgba(255,215,0,.10) 0%,transparent 60%),
    radial-gradient(ellipse 500px 700px at 100% 60%,rgba(59,130,246,.12) 0%,transparent 60%),
    radial-gradient(ellipse 600px 400px at 50% 100%,rgba(26,79,189,.20) 0%,transparent 70%),
    var(--bg);
}
.circle{position:absolute;border-radius:50%;opacity:.10;animation:drift ease-in-out infinite;}
.c1{width:300px;height:300px;background:var(--yellow);top:-90px;right:-70px;animation-duration:13s;}
.c2{width:200px;height:200px;background:var(--sky);bottom:80px;left:-60px;animation-duration:10s;animation-delay:2s;}
.c3{width:130px;height:130px;background:var(--yellow);top:38%;left:8%;animation-duration:16s;animation-delay:4s;opacity:.06;}
.c4{width:100px;height:100px;background:var(--orange);bottom:18%;right:4%;animation-duration:12s;animation-delay:1s;opacity:.08;}
@keyframes drift{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-22px) scale(1.04)}}
.confetti-wrap{position:absolute;inset:0;}
.conf{position:absolute;opacity:0;border-radius:2px;animation:fall linear infinite;}
.conf:nth-child(1){left:5%;width:8px;height:8px;border-radius:50%;background:var(--yellow);animation-duration:7s;}
.conf:nth-child(2){left:18%;width:6px;height:6px;background:#fff;animation-duration:9s;animation-delay:1.5s;}
.conf:nth-child(3){left:32%;width:7px;height:7px;border-radius:50%;background:var(--sky);animation-duration:8s;animation-delay:3s;}
.conf:nth-child(4){left:50%;width:5px;height:5px;background:var(--yellow2);animation-duration:11s;animation-delay:.5s;}
.conf:nth-child(5){left:67%;width:8px;height:8px;border-radius:50%;background:var(--orange);animation-duration:7s;animation-delay:2s;}
.conf:nth-child(6){left:80%;width:6px;height:6px;background:#fff;animation-duration:10s;animation-delay:4s;}
.conf:nth-child(7){left:92%;width:7px;height:7px;border-radius:50%;background:var(--yellow);animation-duration:8s;animation-delay:1s;}
@keyframes fall{
  0%{transform:translateY(-20px) rotate(0deg);opacity:0;}
  8%{opacity:.8;}90%{opacity:.35;}
  100%{transform:translateY(100vh) rotate(400deg);opacity:0;}
}

/* â”€â”€ LAYOUT â”€â”€ */
.wrap{position:relative;z-index:1;max-width:560px;margin:0 auto;padding:0 16px 80px;}

/* â”€â”€ HERO â”€â”€ */
.hero{text-align:center;padding:30px 0 18px;}
.logo-img{
  width:200px;display:block;margin:0 auto 10px;
  filter:drop-shadow(0 4px 20px rgba(255,215,0,.45)) drop-shadow(0 0 40px rgba(255,215,0,.2));
  animation:logoBounce 4s ease-in-out infinite;
}
@keyframes logoBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.year-tag{
  display:inline-block;
  background:linear-gradient(135deg,var(--yellow),var(--orange));
  color:#000;font-weight:800;font-size:13px;
  padding:4px 18px;border-radius:20px;letter-spacing:2px;
  box-shadow:0 4px 14px rgba(255,215,0,.35);margin-bottom:6px;
}
.hero-sub{font-size:13px;color:var(--muted);letter-spacing:1px;}

/* â”€â”€ PRIZE BANNER â”€â”€ */
.prize-banner{
  margin:18px 0;border-radius:26px;overflow:hidden;
  border:2px solid rgba(255,215,0,.4);
  box-shadow:0 0 50px rgba(255,215,0,.18),0 20px 50px rgba(0,0,0,.5);
  position:relative;
}
.prize-img{width:100%;display:block;max-height:280px;object-fit:cover;transition:transform .6s ease;}
.prize-banner:hover .prize-img{transform:scale(1.03);}
.prize-overlay{
  position:absolute;inset:0;
  background:linear-gradient(to top,rgba(11,26,62,.93) 0%,rgba(11,26,62,.3) 55%,transparent 100%);
}
.prize-caption{position:absolute;bottom:0;left:0;right:0;padding:22px 24px;}
.prize-cap-tag{
  display:inline-block;
  background:linear-gradient(135deg,var(--yellow),var(--orange));
  color:#000;font-weight:800;font-size:11px;letter-spacing:2px;
  padding:3px 14px;border-radius:20px;margin-bottom:8px;text-transform:uppercase;
}
.prize-cap-amount{
  font-family:'Fredoka One',cursive;font-size:42px;
  color:var(--yellow);line-height:1;
  text-shadow:0 2px 20px rgba(255,215,0,.5);
}
.prize-cap-sub{font-size:13px;color:rgba(238,244,255,.7);margin-top:4px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECCIÃ“N DE PROGRESO â€” solo logo + barra + %
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prog-section{
  margin:20px 0;
  padding:24px;
  border-radius:24px;
  background:var(--card);
  border:1px solid var(--border);
  text-align:center;
}

/* Logo centrado dentro de la secciÃ³n */
.prog-logo{
  width:100px;display:block;margin:0 auto 18px;
  filter:drop-shadow(0 2px 12px rgba(255,215,0,.35));
  animation:logoBounce 4s ease-in-out infinite;
}

/* Barra de progreso */
.bar-track{
  height:22px;border-radius:999px;
  background:rgba(255,255,255,.06);
  border:1.5px solid var(--border2);
  overflow:hidden;
  position:relative;
  margin-bottom:12px;
}
.bar-fill{
  height:100%;border-radius:999px;width:0%;
  background:linear-gradient(90deg,var(--blue2),var(--sky),var(--yellow2),var(--yellow));
  transition:width 1s cubic-bezier(.4,0,.2,1);
  position:relative;
  display:flex;align-items:center;justify-content:flex-end;
  overflow:visible;
}
/* Brillo animado sobre la barra */
.bar-fill::before{
  content:'';
  position:absolute;inset:0;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,.25),transparent);
  animation:barShine 2.5s ease-in-out infinite;
}
@keyframes barShine{
  0%{transform:translateX(-100%)}
  100%{transform:translateX(100%)}
}
/* Pelota en el extremo */
.bar-fill::after{
  content:'ğŸ°';
  position:absolute;right:-14px;top:50%;
  transform:translateY(-50%);
  font-size:20px;
  filter:drop-shadow(0 0 8px rgba(255,215,0,.7));
}

/* Porcentaje grande y visible */
.prog-pct-display{
  font-family:'Fredoka One',cursive;
  font-size:48px;
  background:linear-gradient(135deg,var(--yellow),var(--orange));
  -webkit-background-clip:text;color:transparent;
  filter:drop-shadow(0 0 16px rgba(255,215,0,.3));
  line-height:1;margin-bottom:6px;
}
.prog-pct-label{
  font-size:13px;font-weight:600;color:var(--muted);
  letter-spacing:2px;text-transform:uppercase;
}

/* Estado cuando llega al 100% */
.sold-out-banner{
  display:none;
  margin-top:16px;
  padding:14px 20px;border-radius:16px;
  background:linear-gradient(135deg,rgba(255,215,0,.15),rgba(255,140,0,.1));
  border:2px solid rgba(255,215,0,.4);
  font-family:'Fredoka One',cursive;
  font-size:18px;color:var(--yellow);
  animation:pulse 1.5s ease-in-out infinite;
}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}

/* â”€â”€ SECTION HEADER â”€â”€ */
.section-hd{
  display:flex;align-items:center;gap:10px;
  font-family:'Fredoka One',cursive;font-size:20px;color:var(--text);
  margin:26px 0 14px;
}
.section-hd::before{
  content:'';display:inline-block;width:5px;height:24px;border-radius:3px;
  background:linear-gradient(180deg,var(--yellow),var(--orange));
}
.section-hd::after{content:'';flex:1;height:2px;background:linear-gradient(90deg,var(--border2),transparent);}

/* â”€â”€ BANCOS â”€â”€ */
.banks{display:flex;flex-direction:column;gap:12px;}
.bank-card{
  display:flex;align-items:center;gap:16px;
  padding:18px 20px;border-radius:20px;
  background:var(--card);border:1px solid var(--border);
  cursor:pointer;transition:all .2s;position:relative;overflow:hidden;
}
.bank-card:hover{border-color:var(--yellow2);box-shadow:0 4px 24px rgba(255,215,0,.18);transform:translateY(-2px);}
.bank-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:5px;border-radius:0 3px 3px 0;}
.bank-card.br::before{background:linear-gradient(180deg,var(--yellow),var(--orange));}
.bank-card.qk::before{background:linear-gradient(180deg,var(--sky),var(--blue));}
.bank-ico{width:50px;height:50px;border-radius:15px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;}
.bank-card.br .bank-ico{background:rgba(255,215,0,.1);border:1px solid rgba(255,215,0,.2);}
.bank-card.qk .bank-ico{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.2);}
.bank-info{flex:1;min-width:0;}
.bank-name{font-weight:800;font-size:15px;color:var(--text);margin-bottom:3px;}
.bank-num{font-family:'Fredoka One',cursive;font-size:18px;color:var(--yellow);letter-spacing:1px;}
.bank-holder{font-size:12px;color:var(--muted);margin-top:2px;}
.copy-btn{
  flex-shrink:0;background:rgba(255,215,0,.1);border:1px solid rgba(255,215,0,.25);
  color:var(--yellow2);border-radius:12px;padding:9px 16px;
  font-size:12px;font-weight:700;cursor:pointer;transition:all .15s;
  font-family:'Poppins',sans-serif;white-space:nowrap;
}
.copy-btn:hover{background:rgba(255,215,0,.2);}
.copy-btn.ok{background:rgba(34,197,94,.12);color:var(--green);border-color:rgba(34,197,94,.3);}
.pay-note{
  text-align:center;margin-top:10px;font-size:12px;color:var(--muted);
  background:rgba(255,215,0,.05);border:1px solid rgba(255,215,0,.1);
  border-radius:12px;padding:10px;
}

/* â”€â”€ FORMULARIO â”€â”€ */
.form-card{
  background:var(--card);border:1px solid var(--border);
  border-radius:24px;padding:28px;margin:20px 0;
}
.field{margin-bottom:18px;}
.field label{
  display:block;font-weight:700;font-size:12px;color:var(--muted);
  text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;
}
.field input{
  width:100%;padding:14px 18px;border-radius:14px;
  border:1.5px solid var(--border);background:var(--bg2);
  color:var(--text);font-family:'Poppins',sans-serif;font-size:15px;
  outline:none;transition:border-color .2s,box-shadow .2s;
}
.field input:focus{border-color:var(--yellow2);box-shadow:0 0 0 3px rgba(255,215,0,.12);}
.field input[type="file"]{padding:13px;font-size:13px;color:var(--muted);cursor:pointer;}
.field input[type="file"]::-webkit-file-upload-button{
  background:var(--border2);color:var(--text);border:none;
  border-radius:8px;padding:8px 16px;font-family:'Poppins',sans-serif;
  font-weight:700;cursor:pointer;margin-right:12px;transition:background .15s;
}
.field input[type="file"]::-webkit-file-upload-button:hover{background:var(--yellow);color:#000;}
.divider{height:1.5px;background:var(--border);margin:22px 0;}

/* Cantidad */
.qty-row{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
.qty-btn{
  width:50px;height:50px;border-radius:14px;
  border:1.5px solid var(--border2);background:var(--bg2);
  color:var(--yellow);font-size:24px;font-weight:900;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .15s;flex-shrink:0;
}
.qty-btn:hover{background:rgba(255,215,0,.12);border-color:var(--yellow2);}
.qty-btn:active{transform:scale(.9);}
.qty-input{
  flex:1;text-align:center;font-family:'Fredoka One',cursive;
  font-size:28px;color:var(--yellow);padding:12px;border-radius:14px;
  border:1.5px solid var(--border2);background:var(--bg2);outline:none;
  transition:border-color .2s;
}
.qty-input:focus{border-color:var(--yellow2);}
.presets{display:flex;gap:8px;margin-bottom:18px;flex-wrap:wrap;}
.preset{
  flex:1;min-width:55px;padding:10px 4px;
  border:1.5px solid var(--border);border-radius:12px;
  background:transparent;color:var(--muted);
  font-family:'Poppins',sans-serif;font-size:13px;font-weight:700;
  cursor:pointer;transition:all .15s;text-align:center;
}
.preset:hover{border-color:var(--yellow2);color:var(--yellow);background:rgba(255,215,0,.07);}

.total-box{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 20px;border-radius:16px;
  background:linear-gradient(135deg,rgba(255,215,0,.09),rgba(255,140,0,.06));
  border:1.5px solid rgba(255,215,0,.25);margin-bottom:20px;
}
.total-lbl{font-weight:700;font-size:13px;color:var(--muted);}
.total-val{font-family:'Fredoka One',cursive;font-size:26px;color:var(--yellow);}

.check-row{display:flex;align-items:flex-start;gap:12px;margin-bottom:22px;cursor:pointer;}
.check-row input[type="checkbox"]{width:22px;height:22px;accent-color:var(--yellow2);flex-shrink:0;margin-top:1px;cursor:pointer;}
.check-row span{font-size:13px;color:var(--muted);line-height:1.6;}
.check-row b{color:var(--yellow2);}

/* â”€â”€ BTN â”€â”€ */
.btn-main{
  width:100%;padding:18px;border:none;border-radius:18px;
  font-family:'Fredoka One',cursive;font-size:18px;letter-spacing:1px;
  cursor:pointer;
  background:linear-gradient(135deg,var(--yellow) 0%,var(--orange) 100%);
  color:#000;position:relative;overflow:hidden;
  transition:transform .15s,box-shadow .2s;
  box-shadow:0 6px 28px rgba(255,215,0,.35),0 2px 8px rgba(0,0,0,.3);
}
.btn-main::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(120deg,transparent 30%,rgba(255,255,255,.35) 50%,transparent 70%);
  transform:translateX(-120%);transition:transform .55s ease;
}
.btn-main:hover::before{transform:translateX(120%);}
.btn-main:hover{transform:translateY(-2px);box-shadow:0 10px 36px rgba(255,215,0,.5);}
.btn-main:active{transform:translateY(1px);}
.btn-main:disabled{
  opacity:.4;cursor:not-allowed;
  background:var(--border);color:var(--muted);
  box-shadow:none;transform:none;
}
.btn-main:disabled::before{display:none;}
.btn-main.secondary{
  background:linear-gradient(135deg,var(--blue),var(--sky));color:#fff;
  box-shadow:0 6px 28px rgba(59,130,246,.3);
}
.btn-main.secondary:hover{box-shadow:0 10px 36px rgba(59,130,246,.45);}

/* â”€â”€ STATUS â”€â”€ */
.status-box{margin-top:16px;padding:16px 18px;border-radius:14px;font-size:14px;line-height:1.6;display:none;}
.status-box.loading{display:block;background:rgba(255,215,0,.07);border:1.5px solid rgba(255,215,0,.2);color:var(--yellow2);}
.status-box.error{display:block;background:rgba(239,68,68,.07);border:1.5px solid rgba(239,68,68,.25);color:var(--red);}
.spinner{
  display:inline-block;width:15px;height:15px;
  border:2.5px solid rgba(255,215,0,.25);border-top-color:var(--yellow);
  border-radius:50%;animation:spin .8s linear infinite;
  vertical-align:middle;margin-right:8px;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ TICKETS â”€â”€ */
.tickets-list{display:flex;flex-direction:column;gap:14px;margin-top:20px;}
.t-item{
  display:flex;border-radius:20px;overflow:hidden;
  background:var(--card2);border:1.5px solid var(--border2);
  position:relative;animation:slideIn .5s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes slideIn{from{opacity:0;transform:translateY(18px) scale(.96)}to{opacity:1;transform:none}}
.t-item::after{
  content:'';position:absolute;left:106px;top:14px;bottom:14px;
  border-left:2px dashed rgba(255,215,0,.18);
}
.t-left{
  width:106px;flex-shrink:0;
  background:linear-gradient(135deg,var(--bg2),var(--card));
  display:flex;align-items:center;justify-content:center;padding:14px;
}
.t-qr{background:#fff;border-radius:10px;padding:5px;width:78px;height:78px;box-shadow:0 0 18px rgba(255,215,0,.25);}
.t-qr img{width:100%;height:100%;display:block;}
.t-right{flex:1;padding:16px 18px;display:flex;flex-direction:column;justify-content:center;}
.t-num{font-family:'Fredoka One',cursive;font-size:34px;color:var(--yellow);letter-spacing:6px;line-height:1;margin-bottom:5px;}
.t-owner{font-size:13px;color:var(--muted);margin-bottom:8px;}
.t-badge{
  display:inline-flex;align-items:center;gap:6px;
  background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.25);
  color:var(--green);border-radius:30px;
  font-size:11px;font-weight:700;padding:4px 12px;width:fit-content;
}
.t-deco{position:absolute;right:12px;bottom:10px;font-size:10px;color:rgba(255,215,0,.15);font-weight:700;letter-spacing:2px;}

/* â”€â”€ BUSCAR â”€â”€ */
.search-res{margin-top:16px;}
.empty-msg{text-align:center;padding:32px;font-size:13px;color:var(--muted);}

/* â”€â”€ FOOTER â”€â”€ */
.footer{
  margin-top:40px;padding:26px;border-radius:22px;
  background:var(--card);border:1px solid var(--border);text-align:center;
}
.footer .year{font-family:'Fredoka One',cursive;font-size:28px;color:var(--yellow);display:block;margin-bottom:6px;}
.footer p{font-size:13px;color:var(--muted);line-height:2;}
.footer b{color:var(--yellow2);}

/* â”€â”€ TOAST â”€â”€ */
.toast{
  position:fixed;top:22px;left:50%;
  transform:translateX(-50%) translateY(-120px);
  background:linear-gradient(135deg,var(--yellow),var(--orange));
  color:#000;font-weight:800;font-size:14px;
  padding:14px 30px;border-radius:50px;z-index:9999;
  transition:transform .4s cubic-bezier(.34,1.56,.64,1);
  white-space:nowrap;box-shadow:0 8px 28px rgba(255,215,0,.4);
  font-family:'Poppins',sans-serif;
}
.toast.on{transform:translateX(-50%) translateY(0);}

@media(max-width:400px){
  .prize-cap-amount{font-size:30px;}
  .form-card{padding:18px;}
  .t-num{font-size:26px;letter-spacing:4px;}
  .t-left{width:90px;}
  .t-qr{width:64px;height:64px;}
  .t-item::after{left:90px;}
  .prog-pct-display{font-size:38px;}
}
</style>
</head>

<body>
<div class="bg-wrap">
  <div class="bg-radial"></div>
  <div class="circle c1"></div><div class="circle c2"></div>
  <div class="circle c3"></div><div class="circle c4"></div>
  <div class="confetti-wrap">
    <div class="conf"></div><div class="conf"></div><div class="conf"></div>
    <div class="conf"></div><div class="conf"></div><div class="conf"></div>
    <div class="conf"></div>
  </div>
</div>
<div class="toast" id="toast"></div>

<div class="wrap">

  <!-- HERO -->
  <div class="hero">
    <img src="logo.png" class="logo-img" alt="RifariRD"
         onerror="this.style.display='none'">
    <div class="year-tag">âœ¨ 2026 âœ¨</div><br>
    <span class="hero-sub">RepÃºblica Dominicana Â· Rifa Oficial</span>
  </div>

  <!-- IMAGEN PREMIO -->
  <div class="prize-banner">
    <img src="fondo.jpg" class="prize-img" alt="Premio RifariRD"
         onerror="this.src='https://images.unsplash.com/photo-1616514169536-dd2bde3f7543?w=600&q=80'">
    <div class="prize-overlay"></div>
    <div class="prize-caption">
      <div class="prize-cap-tag">ğŸ† Premio Mayor</div>
      <div class="prize-cap-amount">ğŸ’µ RD$50,000</div>
      <div class="prize-cap-sub">En efectivo Â· Pesos Dominicanos</div>
    </div>
  </div>

  <!-- â•â•â•â• PROGRESO: solo logo + barra + % â•â•â•â• -->
  <div class="prog-section">

    <!-- Logo centrado -->
    <img src="logo.png" class="prog-logo" alt="RifariRD"
         onerror="this.style.display='none'">

    <!-- Barra -->
    <div class="bar-track">
      <div class="bar-fill" id="barFill"></div>
    </div>

    <!-- Porcentaje grande -->
    <div class="prog-pct-display" id="pctDisplay">0%</div>
    <div class="prog-pct-label">de boletos vendidos</div>

    <!-- Mensaje sold out -->
    <div class="sold-out-banner" id="soldOutBanner">
      ğŸ‰ Â¡Todos los boletos han sido vendidos!
    </div>

  </div>

  <!-- BANCOS -->
  <div class="section-hd">ğŸ’³ CÃ³mo pagar</div>
  <div class="banks">
    <div class="bank-card br" onclick="copiar('9601539179','btn-br')">
      <div class="bank-ico">ğŸ¦</div>
      <div class="bank-info">
        <div class="bank-name">Banreservas</div>
        <div class="bank-num">9601539179</div>
        <div class="bank-holder">Jeffrey Flores Â· Cuenta de Ahorro</div>
      </div>
      <button class="copy-btn" id="btn-br"
              onclick="event.stopPropagation();copiar('9601539179','btn-br')">ğŸ“‹ Copiar</button>
    </div>
    <div class="bank-card qk" onclick="copiar('1003191261','btn-qk')">
      <div class="bank-ico">ğŸ“±</div>
      <div class="bank-info">
        <div class="bank-name">Qik Â· Ahorro</div>
        <div class="bank-num">1003191261</div>
        <div class="bank-holder">Jeffrey Flores</div>
      </div>
      <button class="copy-btn" id="btn-qk"
              onclick="event.stopPropagation();copiar('1003191261','btn-qk')">ğŸ“‹ Copiar</button>
    </div>
  </div>
  <div class="pay-note">âš ï¸ Guarda tu comprobante de pago antes de registrarte</div>

  <!-- FORMULARIO -->
  <div class="form-card">
    <div class="section-hd">ğŸŸï¸ Registrar mis boletos</div>

    <div class="field">
      <label>ğŸ‘¤ Nombre</label>
      <input id="nombre" type="text" placeholder="Tu nombre">
    </div>
    <div class="field">
      <label>ğŸ‘¤ Apellido</label>
      <input id="apellido" type="text" placeholder="Tu apellido">
    </div>
    <div class="field">
      <label>ğŸ“± TelÃ©fono / WhatsApp</label>
      <input id="telefono" type="tel" placeholder="809-XXX-XXXX">
    </div>

    <div class="divider"></div>
    <div class="section-hd">ğŸ”¢ Cantidad de boletos</div>

    <div class="qty-row">
      <button class="qty-btn" onclick="cambiar(-1)">âˆ’</button>
      <input class="qty-input" id="cantidad" type="number" min="1" max="500" value="1">
      <button class="qty-btn" onclick="cambiar(1)">+</button>
    </div>
    <div class="presets">
      <button class="preset" onclick="setCant(5)">Ã— 5</button>
      <button class="preset" onclick="setCant(10)">Ã— 10</button>
      <button class="preset" onclick="setCant(25)">Ã— 25</button>
      <button class="preset" onclick="setCant(50)">Ã— 50</button>
    </div>

    <div class="total-box">
      <span class="total-lbl">ğŸ’° Total a pagar</span>
      <span class="total-val">RD$ <span id="totalVal">25</span></span>
    </div>

    <div class="field">
      <label>ğŸ“¸ Comprobante de pago</label>
      <input type="file" id="comprobante" accept="image/*">
    </div>

    <label class="check-row">
      <input type="checkbox" id="terminos">
      <span>Acepto los <b>tÃ©rminos y condiciones</b>. El ganador se selecciona al venderse el 100% de los boletos.</span>
    </label>

    <button class="btn-main" id="btnReg" onclick="registrar()">
      ğŸŸï¸ Â¡Registrar y obtener mis boletos!
    </button>
    <div class="status-box" id="statusBox"></div>
    <div class="tickets-list" id="ticketsList"></div>
  </div>

  <!-- BUSCAR -->
  <div class="form-card">
    <div class="section-hd">ğŸ” Ver mis boletos</div>
    <div class="field">
      <label>ğŸ“± Tu nÃºmero de telÃ©fono</label>
      <input id="buscarTel" type="tel" placeholder="809-XXX-XXXX">
    </div>
    <button class="btn-main secondary" onclick="buscar()">ğŸ” Buscar mis boletos</button>
    <div class="search-res" id="searchRes"></div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <span class="year">RifariRD 2026</span>
    <p>
      âš–ï¸ El ganador serÃ¡ elegido Ãºnicamente cuando se venda el <b>100%</b> de los boletos.<br>
      Cada boleto tiene un <b>cÃ³digo QR Ãºnico</b> de verificaciÃ³n.<br>
      ğŸ‡©ğŸ‡´ Â© 2026 <b>RifariRD</b> Â· RepÃºblica Dominicana
    </p>
  </div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:            "AIzaSyCKyR0Y8oTMDvQOI_j03uRMQiqjZvBysxw",
  authDomain:        "rifarird.firebaseapp.com",
  projectId:         "rifarird",
  storageBucket:     "rifarird.appspot.com",
  messagingSenderId: "1025146093171",
  appId:             "1:1025146093171:web:cfbb5d16d59b14f89c3406"
});
const db         = firebase.firestore();
const storage    = firebase.storage();
const FieldValue = firebase.firestore.FieldValue; // âœ…

const TOTAL  = 10000;
const PRECIO = 25;
const BASE   = (()=>{
  const p = location.pathname.replace(/\/[^/]*$/, '/');
  return location.origin + p;
})();

/* DOM */
const nombreEl   = document.getElementById("nombre");
const apellidoEl = document.getElementById("apellido");
const telefonoEl = document.getElementById("telefono");
const cantEl     = document.getElementById("cantidad");
const comprEl    = document.getElementById("comprobante");
const termEl     = document.getElementById("terminos");
const totalValEl = document.getElementById("totalVal");
const barFill    = document.getElementById("barFill");
const pctDisplay = document.getElementById("pctDisplay");
const soldOut    = document.getElementById("soldOutBanner");
const btnReg     = document.getElementById("btnReg");
const statusBox  = document.getElementById("statusBox");
const ticketList = document.getElementById("ticketsList");
const toastEl    = document.getElementById("toast");

/* TOAST */
let toastT;
function toast(msg){
  toastEl.textContent=msg;toastEl.classList.add("on");
  clearTimeout(toastT);toastT=setTimeout(()=>toastEl.classList.remove("on"),2800);
}

/* COPIAR */
function copiar(num,btnId){
  navigator.clipboard.writeText(num)
    .then(()=>toast("âœ… NÃºmero copiado: "+num))
    .catch(()=>toast("NÃºmero: "+num));
  const b=document.getElementById(btnId);
  if(!b)return;
  b.textContent="âœ“ Copiado";b.classList.add("ok");
  setTimeout(()=>{b.textContent="ğŸ“‹ Copiar";b.classList.remove("ok");},2200);
}

/* CANTIDAD / TOTAL */
function actualizarTotal(){
  const v=Math.max(1,parseInt(cantEl.value)||1);
  totalValEl.textContent=(v*PRECIO).toLocaleString("es-DO");
}
cantEl.addEventListener("input",actualizarTotal);
function cambiar(d){cantEl.value=Math.max(1,(parseInt(cantEl.value)||1)+d);actualizarTotal();}
function setCant(n){cantEl.value=n;actualizarTotal();}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESO EN TIEMPO REAL
   Solo muestra barra + porcentaje
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
db.collection("stats").doc("global").onSnapshot(doc=>{
  if(!doc.exists)return;
  const{vendidos=0, total=TOTAL}=doc.data();
  const pct = Math.min(Math.round((vendidos/total)*100), 100);

  // Actualizar barra
  barFill.style.width = pct + "%";

  // Actualizar porcentaje grande
  pctDisplay.textContent = pct + "%";

  // Si llegÃ³ al 100%
  if(pct >= 100){
    btnReg.disabled = true;
    btnReg.textContent = "ğŸ‰ Â¡Rifa Completada!";
    soldOut.style.display = "block";
  }
}, e=>console.warn("Stats:",e));

/* STATUS */
function setStatus(msg,tipo="loading"){
  statusBox.className="status-box "+tipo;
  statusBox.innerHTML=tipo==="loading"?`<span class="spinner"></span>${msg}`:msg;
  statusBox.style.display="block";
}
function clearStatus(){statusBox.style.display="none";}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NÃšMERO ÃšNICO CON TRANSACCIÃ“N ATÃ“MICA
   Garantiza que no se repitan nÃºmeros
   aunque varios usuarios compren al mismo tiempo
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function numUnico(){
  for(let intento=0; intento<50; intento++){
    // NÃºmero aleatorio entre 0000 y 9999
    const n = Math.floor(Math.random()*TOTAL).toString().padStart(4,"0");
    const ref = db.collection("tickets").doc(n);
    try{
      // La transacciÃ³n bloquea el documento mientras lo verifica
      // Si otro usuario ya lo tomÃ³, lanza "OCUPADO" y volvemos a intentar
      await db.runTransaction(async tx=>{
        const snap = await tx.get(ref);
        if(snap.exists) throw new Error("OCUPADO");
        tx.set(ref, {reservado:true}); // reserva el nÃºmero inmediatamente
      });
      return n; // nÃºmero libre y reservado con Ã©xito
    }catch(e){
      if(e.message !== "OCUPADO") throw e;
      // NÃºmero ocupado â†’ siguiente intento con nÃºmero diferente
    }
  }
  throw new Error("No se encontrÃ³ nÃºmero disponible. Intenta de nuevo.");
}

/* QR con URL de verificaciÃ³n */
function qrURL(num){
  const url = `${BASE}tickets.html?id=${num}`;
  return `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}&color=1A4FBD&bgcolor=FFFFFF`;
}

/* Render ticket visual */
function renderTicket(num,nombre,apellido,qr,container,delay=0){
  const d=document.createElement("div");
  d.className="t-item";d.style.animationDelay=delay+"ms";
  d.innerHTML=`
    <div class="t-left">
      <div class="t-qr"><img src="${qr}" alt="QR ${num}" loading="lazy"></div>
    </div>
    <div class="t-right">
      <div class="t-num">${num}</div>
      <div class="t-owner">${nombre} ${apellido}</div>
      <span class="t-badge">âœ… Registrado Â· RifariRD</span>
    </div>
    <div class="t-deco">RIFARIRD 2026</div>`;
  container.appendChild(d);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REGISTRAR BOLETOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function registrar(){
  const nombre   = nombreEl.value.trim();
  const apellido = apellidoEl.value.trim();
  const telefono = telefonoEl.value.trim();
  const cantidad = Math.max(1,parseInt(cantEl.value)||1);
  const archivo  = comprEl.files[0];

  if(!nombre||!apellido||!telefono){
    setStatus("âš ï¸ Completa tu nombre, apellido y telÃ©fono.","error"); return;
  }
  if(!archivo){
    setStatus("âš ï¸ Adjunta tu comprobante de pago.","error"); return;
  }
  if(!termEl.checked){
    setStatus("âš ï¸ Acepta los tÃ©rminos y condiciones.","error"); return;
  }

  btnReg.disabled=true;
  ticketList.innerHTML="";
  setStatus("ğŸ“¤ Subiendo comprobante...");

  let comprURL="";
  try{
    const ref=storage.ref(`comprobantes/${Date.now()}_${archivo.name}`);
    await ref.put(archivo);
    comprURL=await ref.getDownloadURL();
  }catch(e){
    setStatus("âŒ Error al subir comprobante: "+e.message,"error");
    btnReg.disabled=false; return;
  }

  for(let i=0;i<cantidad;i++){
    setStatus(`ğŸŸï¸ Generando boleto ${i+1} de ${cantidad}...`);
    try{
      // Obtener nÃºmero Ãºnico (no repetido, bloqueado con transacciÃ³n)
      const num = await numUnico();
      const qr  = qrURL(num);

      // Guardar datos completos del ticket
      await db.collection("tickets").doc(num).set({
        nombre, apellido, telefono,
        numero: num,
        qr,
        comprobante: comprURL,
        fecha: new Date().toISOString()
      });

      // Incrementar contador de vendidos en stats
      await db.collection("stats").doc("global").update({
        vendidos: FieldValue.increment(1)  // âœ… Fix correcto
      });

      // Mostrar ticket en pantalla
      renderTicket(num,nombre,apellido,qr,ticketList,i*90);

    }catch(e){
      setStatus(`âŒ Error en boleto ${i+1}: ${e.message}`,"error");
      btnReg.disabled=false; return;
    }
  }

  clearStatus();
  btnReg.disabled=false;
  toast(`ğŸ‰ Â¡${cantidad} boleto${cantidad>1?"s":""} registrado${cantidad>1?"s":""}!`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUSCAR BOLETOS POR TELÃ‰FONO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function buscar(){
  const tel=document.getElementById("buscarTel").value.trim();
  if(!tel)return;
  const sr=document.getElementById("searchRes");
  sr.innerHTML=`<div class="empty-msg"><span class="spinner"></span> Buscando tus boletos...</div>`;
  try{
    const q=await db.collection("tickets").where("telefono","==",tel).get();
    if(q.empty){
      sr.innerHTML=`<div class="empty-msg">ğŸ“­ No encontramos boletos con ese nÃºmero.</div>`;
      return;
    }
    const grid=document.createElement("div");
    grid.className="tickets-list";grid.style.marginTop="16px";
    let i=0;
    q.forEach(d=>{
      const t=d.data();
      // Omitir placeholders de transacciones
      if(!t.reservado) renderTicket(t.numero,t.nombre,t.apellido,t.qr,grid,i*80);
      i++;
    });
    sr.innerHTML="";sr.appendChild(grid);
  }catch(e){
    sr.innerHTML=`<div class="empty-msg" style="color:#EF4444">âŒ Error: ${e.message}</div>`;
  }
}
</script>
</body>
</html>
